(function(e,t,n){e.fn.jScrollPane=function(r){function i(r,i){function s(t){var i,u,f,c,h,p,m=!1,g=!1;R=t;if(z===n)h=r.scrollTop(),p=r.scrollLeft(),r.css({overflow:"hidden",padding:0}),W=r.innerWidth()+wt,X=r.innerHeight(),r.width(W),z=e('<div class="jspPane" />').css("padding",bt).append(r.children()),V=e('<div class="jspContainer" />').css({width:W+"px",height:X+"px"}).append(z).appendTo(r);else{r.css("width",""),m=R.stickToBottom&&L(),g=R.stickToRight&&A(),c=r.innerWidth()+wt!=W||r.outerHeight()!=X,c&&(W=r.innerWidth()+wt,X=r.innerHeight(),V.css({width:W+"px",height:X+"px"}));if(!c&&Et==$&&z.outerHeight()==J){r.width(W+5);return}Et=$,z.css("width",""),r.width(W),V.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}z.css("overflow","auto"),t.contentWidth?$=t.contentWidth:$=z[0].scrollWidth,J=z[0].scrollHeight,z.css("overflow",""),K=$/W,Q=J/X,G=Q>1,Y=K>1,!Y&&!G?(r.removeClass("jspScrollable"),z.css({top:0,width:V.width()-wt}),M(),P(),B(),v()):(r.addClass("jspScrollable"),i=R.maintainPosition&&(tt||it),i&&(u=C(),f=k()),o(),a(),l(),i&&(T(g?$-W:u,!1),x(m?J-X:f,!1)),D(),O(),I(),R.enableKeyboardNavigation&&H(),R.clickOnTrack&&d(),j(),R.hijackInternalLinks&&F()),R.autoReinitialise&&!yt?yt=setInterval(function(){s(R)},R.autoReinitialiseDelay):!R.autoReinitialise&&yt&&clearInterval(yt),h&&r.scrollTop(0)&&x(h,!1),p&&r.scrollLeft(0)&&T(p,!1),r.trigger("jsp-initialised",[Y||G])}function o(){G&&(V.append(e('<div class="jspVerticalBar" />').append(e('<div class="jspCap jspCapTop" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragTop" />'),e('<div class="jspDragBottom" />'))),e('<div class="jspCap jspCapBottom" />'))),st=V.find(">.jspVerticalBar"),ot=st.find(">.jspTrack"),Z=ot.find(">.jspDrag"),R.showArrows&&(lt=e('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",h(0,-1)).bind("click.jsp",_),ct=e('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",h(0,1)).bind("click.jsp",_),R.arrowScrollOnHover&&(lt.bind("mouseover.jsp",h(0,-1,lt)),ct.bind("mouseover.jsp",h(0,1,ct))),c(ot,R.verticalArrowPositions,lt,ct)),at=X,V.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){at-=e(this).outerHeight()}),Z.hover(function(){Z.addClass("jspHover")},function(){Z.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",_),Z.addClass("jspActive");var n=t.pageY-Z.position().top;return e("html").bind("mousemove.jsp",function(e){g(e.pageY-n,!1)}).bind("mouseup.jsp mouseleave.jsp",m),!1}),u())}function u(){ot.height(at+"px"),tt=0,ut=R.verticalGutter+ot.outerWidth(),z.width(W-ut-wt+5),z.width()>500&&z.width(W-ut-wt+20);try{st.position().left===0&&z.css("margin-left",ut+"px")}catch(e){}}function a(){Y&&(V.append(e('<div class="jspHorizontalBar" />').append(e('<div class="jspCap jspCapLeft" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragLeft" />'),e('<div class="jspDragRight" />'))),e('<div class="jspCap jspCapRight" />'))),ht=V.find(">.jspHorizontalBar"),pt=ht.find(">.jspTrack"),nt=pt.find(">.jspDrag"),R.showArrows&&(mt=e('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",h(-1,0)).bind("click.jsp",_),gt=e('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",h(1,0)).bind("click.jsp",_),R.arrowScrollOnHover&&(mt.bind("mouseover.jsp",h(-1,0,mt)),gt.bind("mouseover.jsp",h(1,0,gt))),c(pt,R.horizontalArrowPositions,mt,gt)),nt.hover(function(){nt.addClass("jspHover")},function(){nt.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",_),nt.addClass("jspActive");var n=t.pageX-nt.position().left;return e("html").bind("mousemove.jsp",function(e){b(e.pageX-n,!1)}).bind("mouseup.jsp mouseleave.jsp",m),!1}),dt=V.innerWidth(),f())}function f(){V.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){dt-=e(this).outerWidth()}),pt.width(dt+"px"),it=0}function l(){if(Y&&G){var t=pt.outerHeight(),n=ot.outerWidth();at-=t,e(ht).find(">.jspCap:visible,>.jspArrow").each(function(){dt+=e(this).outerWidth()}),dt-=n,X-=n,W-=t,pt.parent().append(e('<div class="jspCorner" />').css("width",t+"px")),u(),f()}Y&&z.width(V.outerWidth()-wt+"px"),J=z.outerHeight(),Q=J/X,Y&&(vt=Math.ceil(1/K*dt),vt>R.horizontalDragMaxWidth?vt=R.horizontalDragMaxWidth:vt<R.horizontalDragMinWidth&&(vt=R.horizontalDragMinWidth),nt.width(vt+"px"),rt=dt-vt,w(it)),G&&(ft=Math.ceil(1/Q*at),ft>R.verticalDragMaxHeight?ft=R.verticalDragMaxHeight:ft<R.verticalDragMinHeight&&(ft=R.verticalDragMinHeight),Z.height(ft+"px"),et=at-ft,y(tt))}function c(e,t,n,r){var i="before",s="after",o;t=="os"&&(t=/Mac/.test(navigator.platform)?"after":"split"),t==i?s=t:t==s&&(i=t,o=n,n=r,r=o),e[i](n)[s](r)}function h(e,t,n){return function(){return p(e,t,this,n),this.blur(),!1}}function p(t,n,r,i){r=e(r).addClass("jspActive");var s,o,u=!0,a=function(){t!==0&&U.scrollByX(t*R.arrowButtonSpeed),n!==0&&U.scrollByY(n*R.arrowButtonSpeed),o=setTimeout(a,u?R.initialDelay:R.arrowRepeatFreq),u=!1};a(),s=i?"mouseout.jsp":"mouseup.jsp",i=i||e("html"),i.bind(s,function(){r.removeClass("jspActive"),o&&clearTimeout(o),o=null,i.unbind(s)})}function d(){v(),G&&ot.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var r=e(this),i=r.offset(),s=t.pageY-i.top-tt,o,u=!0,a=function(){var e=r.offset(),n=t.pageY-e.top-ft/2,i=X*R.scrollPagePercent,l=et*i/(J-X);if(s<0)tt-l>n?U.scrollByY(-i):g(n);else{if(!(s>0)){f();return}tt+l<n?U.scrollByY(i):g(n)}o=setTimeout(a,u?R.initialDelay:R.trackClickRepeatFreq),u=!1},f=function(){o&&clearTimeout(o),o=null,e(document).unbind("mouseup.jsp",f)};return a(),e(document).bind("mouseup.jsp",f),!1}}),Y&&pt.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var r=e(this),i=r.offset(),s=t.pageX-i.left-it,o,u=!0,a=function(){var e=r.offset(),n=t.pageX-e.left-vt/2,i=W*R.scrollPagePercent,l=rt*i/($-W);if(s<0)it-l>n?U.scrollByX(-i):b(n);else{if(!(s>0)){f();return}it+l<n?U.scrollByX(i):b(n)}o=setTimeout(a,u?R.initialDelay:R.trackClickRepeatFreq),u=!1},f=function(){o&&clearTimeout(o),o=null,e(document).unbind("mouseup.jsp",f)};return a(),e(document).bind("mouseup.jsp",f),!1}})}function v(){pt&&pt.unbind("mousedown.jsp"),ot&&ot.unbind("mousedown.jsp")}function m(){e("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),Z&&Z.removeClass("jspActive"),nt&&nt.removeClass("jspActive")}function g(e,t){if(!G)return;e<0?e=0:e>et&&(e=et),t===n&&(t=R.animateScroll),t?U.animate(Z,"top",e,y):(Z.css("top",e),y(e))}function y(e){e===n&&(e=Z.position().top),V.scrollTop(0),tt=e;var t=tt===0,i=tt==et,s=e/et,o=-s*(J-X);if(St!=t||Tt!=i)St=t,Tt=i,r.trigger("jsp-arrow-change",[St,Tt,xt,Nt]);E(t,i),z.css("top",o),r.trigger("jsp-scroll-y",[-o,t,i]).trigger("scroll")}function b(e,t){if(!Y)return;e<0?e=0:e>rt&&(e=rt),t===n&&(t=R.animateScroll),t?U.animate(nt,"left",e,w):(nt.css("left",e),w(e))}function w(e){e===n&&(e=nt.position().left),V.scrollTop(0),it=e;var t=it===0,i=it==rt,s=e/rt,o=-s*($-W);if(xt!=t||Nt!=i)xt=t,Nt=i,r.trigger("jsp-arrow-change",[St,Tt,xt,Nt]);S(t,i),z.css("left",o),r.trigger("jsp-scroll-x",[-o,t,i]).trigger("scroll")}function E(e,t){R.showArrows&&(lt[e?"addClass":"removeClass"]("jspDisabled"),ct[t?"addClass":"removeClass"]("jspDisabled"))}function S(e,t){R.showArrows&&(mt[e?"addClass":"removeClass"]("jspDisabled"),gt[t?"addClass":"removeClass"]("jspDisabled"))}function x(e,t){var n=e/(J-X);g(n*et,t)}function T(e,t){var n=e/($-W);b(n*rt,t)}function N(t,n,r){var i,s,o,u=0,a=0,f,l,c,h,p,d;try{i=e(t)}catch(v){return}s=i.outerHeight(),o=i.outerWidth(),V.scrollTop(0),V.scrollLeft(0);while(!i.is(".jspPane")){u+=i.position().top,a+=i.position().left,i=i.offsetParent();if(/^body|html$/i.test(i[0].nodeName))return}f=k(),c=f+X,u<f||n?p=u-R.verticalGutter:u+s>c&&(p=u-X+s+R.verticalGutter),p&&x(p,r),l=C(),h=l+W,a<l||n?d=a-R.horizontalGutter:a+o>h&&(d=a-W+o+R.horizontalGutter),d&&T(d,r)}function C(){return-z.position().left}function k(){return-z.position().top}function L(){var e=J-X;return e>20&&e-k()<10}function A(){var e=$-W;return e>20&&e-C()<10}function O(){V.unbind(kt).bind(kt,function(e,t,n,r){var i=it,s=tt;return U.scrollBy(n*R.mouseWheelSpeed,-r*R.mouseWheelSpeed,!1),i==it&&s==tt})}function M(){V.unbind(kt)}function _(){return!1}function D(){z.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){N(e.target,!1)})}function P(){z.find(":input,a").unbind("focus.jsp")}function H(){function t(){var e=it,t=tt;switch(n){case 40:U.scrollByY(R.keyboardSpeed,!1);break;case 38:U.scrollByY(-R.keyboardSpeed,!1);break;case 34:case 32:U.scrollByY(X*R.scrollPagePercent,!1);break;case 33:U.scrollByY(-X*R.scrollPagePercent,!1);break;case 39:U.scrollByX(R.keyboardSpeed,!1);break;case 37:U.scrollByX(-R.keyboardSpeed,!1)}return i=e!=it||t!=tt,i}var n,i,s=[];Y&&s.push(ht[0]),G&&s.push(st[0]),z.focus(function(){r.focus()}),r.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(r){if(r.target!==this&&(!s.length||!e(r.target).closest(s).length))return;var o=it,u=tt;switch(r.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:n=r.keyCode,t();break;case 35:x(J-X),n=null;break;case 36:x(0),n=null}return i=r.keyCode==n&&o!=it||u!=tt,!i}).bind("keypress.jsp",function(e){return e.keyCode==n&&t(),!i}),R.hideFocus?(r.css("outline","none"),"hideFocus"in V[0]&&r.attr("hideFocus",!0)):(r.css("outline",""),"hideFocus"in V[0]&&r.attr("hideFocus",!1))}function B(){r.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function j(){if(location.hash&&location.hash.length>1){var t,n,r=escape(location.hash.substr(1));try{t=e("#"+r+', a[name="'+r+'"]')}catch(i){return}t.length&&z.find(r)&&(V.scrollTop()===0?n=setInterval(function(){V.scrollTop()>0&&(N(t,!0),e(document).scrollTop(V.position().top),clearInterval(n))},50):(N(t,!0),e(document).scrollTop(V.position().top)))}}function F(){if(e(document.body).data("jspHijack"))return;e(document.body).data("jspHijack",!0),e(document.body).delegate("a[href*=#]","click",function(n){var r=this.href.substr(0,this.href.indexOf("#")),i=location.href,s,o,u,a,f,l;location.href.indexOf("#")!==-1&&(i=location.href.substr(0,location.href.indexOf("#")));if(r!==i)return;s=escape(this.href.substr(this.href.indexOf("#")+1)),o;try{o=e("#"+s+', a[name="'+s+'"]')}catch(c){return}if(!o.length)return;u=o.closest(".jspScrollable"),a=u.data("jsp"),a.scrollToElement(o,!0),u[0].scrollIntoView&&(f=e(t).scrollTop(),l=o.offset().top,(l<f||l>f+e(t).height())&&u[0].scrollIntoView()),n.preventDefault()})}function I(){var e,t,n,r,i,s=!1;V.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(o){var u=o.originalEvent.touches[0];e=C(),t=k(),n=u.pageX,r=u.pageY,i=!1,s=!0}).bind("touchmove.jsp",function(o){if(!s)return;var u=o.originalEvent.touches[0],a=it,f=tt;return U.scrollTo(e+n-u.pageX,t+r-u.pageY),i=i||Math.abs(n-u.pageX)>5||Math.abs(r-u.pageY)>5,a==it&&f==tt}).bind("touchend.jsp",function(e){s=!1}).bind("click.jsp-touchclick",function(e){if(i)return i=!1,!1})}function q(){var e=k(),t=C();r.removeClass("jspScrollable").unbind(".jsp"),r.replaceWith(Ct.append(z.children())),Ct.scrollTop(e),Ct.scrollLeft(t),yt&&clearInterval(yt)}var R,U=this,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St=!0,xt=!0,Tt=!1,Nt=!1,Ct=r.clone(!1,!1).empty(),kt=e.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";bt=r.css("paddingTop")+" "+r.css("paddingRight")+" "+r.css("paddingBottom")+" "+r.css("paddingLeft"),wt=(parseInt(r.css("paddingLeft"),10)||0)+(parseInt(r.css("paddingRight"),10)||0),e.extend(U,{reinitialise:function(t){t=e.extend({},R,t),s(t)},scrollToElement:function(e,t,n){N(e,t,n)},scrollTo:function(e,t,n){T(e,n),x(t,n)},scrollToX:function(e,t){T(e,t)},scrollToY:function(e,t){x(e,t)},scrollToPercentX:function(e,t){T(e*($-W),t)},scrollToPercentY:function(e,t){x(e*(J-X),t)},scrollBy:function(e,t,n){U.scrollByX(e,n),U.scrollByY(t,n)},scrollByX:function(e,t){var n=C()+Math[e<0?"floor":"ceil"](e),r=n/($-W);b(r*rt,t)},scrollByY:function(e,t){var n=k()+Math[e<0?"floor":"ceil"](e),r=n/(J-X);g(r*et,t)},positionDragX:function(e,t){b(e,t)},positionDragY:function(e,t){g(e,t)},animate:function(e,t,n,r){var i={};i[t]=n,e.animate(i,{duration:R.animateDuration,easing:R.animateEase,queue:!1,step:r})},getContentPositionX:function(){return C()},getContentPositionY:function(){return k()},getContentWidth:function(){return $},getContentHeight:function(){return J},getPercentScrolledX:function(){return C()/($-W)},getPercentScrolledY:function(){return k()/(J-X)},getIsScrollableH:function(){return Y},getIsScrollableV:function(){return G},getContentPane:function(){return z},scrollToBottom:function(e){g(et,e)},hijackInternalLinks:e.noop,destroy:function(){q()}}),s(i)}return r=e.extend({},e.fn.jScrollPane.defaults,r),e.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){r[this]=r[this]||r.speed}),this.each(function(){var t=e(this),n=t.data("jsp");n?n.reinitialise(r):(e("script",t).filter('[type="text/javascript"],:not([type])').remove(),n=new i(t,r),t.data("jsp",n))})};var r=1;e.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:100,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:n,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}})(jQuery,this);